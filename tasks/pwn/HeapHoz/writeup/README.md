# HeapHoz

_Author: [@phoen1xxx]

> hi-hi ha-ha

## Решение

### TL;DR
Пишем в буфер command "echo mua-ha-ha", удаляем его, меняем на /bin/sh и запускаем исполнение команды, поскольку блок освобожден, он не запишется в буфер command, проверка будет пройдена и будет исполнена наша команда.
### Полное решение

Дана программа, в которой можно создавать структуру, удалять структуру, изменять структуру или запускать команду, если она равно "echo mua-ha-ha". 
Уязвимость заключается в следующем участке кода:

    if(hehes[index].allocated==1){
        memcpy(command,hehes[index].name,0x50);
        command[0x50-1]='\0';
    }
    if(strcmp(command,"echo Mua-ha-ha")==0)
        system(hehes[index].name);
1) memcpy выполняется только если поле allocated =1. То есть если мы попытаемся передать освобожденный чанк, копирования не произойдет.
2) Проверка буфера command и исполнение команды принимают на выход разные буфферы. Если мы что-то запишем в command, и сможем вызвать исполнение команды, не перезаписывая command, мы сможем вызвать произвольную команду.

Комбинируя данные уязвимости получаем shell.

