# heap_escape

_Author: [@phoen1xxx]

>  I've implemented unbelievable secure heap. Try to break it.

## Решение

### TL;DR
Проводим атаку, аналогичную tcache poisoning, переписав next addr в чанке на 1. Выделяемся и переписываем heap_base на адрес внутри got. Делаем лик libc и перезаписываем atoiна system. Вызваем шелл.

### Полное решение

В программе можно добавлять пароль, удалять сохраненный пароль, выводить его или изменять. При этом все функции malloc/free изменены на кастмоные, исходный код которых дан. С
помощью use-after-free edit мы можем изменять внутренние структуры кастомной кучи. Аналогично tcache poisoning изменим next ptr freed чанка на 1. Поскольку куча построена на
heap_base указатели и оффсетах от него, на которых вычисляются реальные адреса, то чанкс оффсетом 1 будет выделен прямо внутри структуры кучи, которая тоже хранится внутри этой области памяти. С помощью нее мы сможем перетеркть heap_base на адрес внутри got(pie выключен), после чего считыванием ликнуть libc. Далее просто перетираем функцию atoi на system и вместо любого ввода вводим /bin/sh, поскольку для каждого числа вызвается atoi.

