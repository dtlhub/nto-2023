# PopRop

_Author: [@phoen1xxx]

> Can you do rop just with pop?

## Решение

### TL;DR
Rop с двумя stack pivoting

### Полное решение

Уязвимость заключается в следующем:
  char buf[8];
  read(STDIN_FILENO,buf,0x28);
Обычный stack overflow.Однако поскольку переполнение небольшое(в отладчике можно увидеть,что у нас есть возможно исполнения всего двух гаджетов), то нам необходимо провести stack pivoting. У нас есть глобальная переменная message, pie выключен, поэтому можно пивотиться туда. К счастью, у нас есть гаджет pop rsp, что упрощает ситуацию. Сделав 1 пивотинг и исполнив system("/bin/sh") ничего не сработает. Посмотрим в отладчике, почему так происходит. Внутри функции system происходит выделение памяти на стеке под локальные переменные путем sub rsp. И после нескольких таких итераций наш стек уменьшается настолько, что вылезает в non writable память. Поэтому сделаем второй пивотинг, вызвав функцию read из бинаря на место второго пивотинга(на 0х800-0х900 байт выше по нашей области)

